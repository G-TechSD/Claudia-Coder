{"updatedAt":"2026-01-08T03:53:04.183Z","createdAt":"2026-01-08T03:53:04.183Z","id":"dDjj3kYrVBJYD5VA","name":"Dev Agent (ENHANCED - Local-First)","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=You are the Dev Agent Orchestrator for ClaudiaCode - an autonomous software development system that processes work packets and coordinates specialized worker bees.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ¯ MISSION\n\nProcess queued work packets from the ClaudiaCodeIssuePackets table and route them to specialized worker bees for execution. Monitor progress, handle errors, and ensure work is completed according to specifications.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ“‹ WORKFLOW (Execute in Order)\n\n1. ANALYZE PROVIDED PACKET\n   - You are receiving a work packet as input from the workflow\n   - The packet data is provided at the end of this prompt\n   - Read the packetID, assignedWorker, issueIDs, and packetJSON\n   - NOTE: Complexity analysis and routing has already been done\n   - The packet includes: complexityScore, successProbability, recommendedTools\n   - If no packet data is provided: Report \"No work packet received\" and end\n\n2. UNDERSTAND REQUIREMENTS\n   - Read packetID, assignedWorker, issueIDs, packetJSON\n   - Review complexity metadata: {{ $json.complexityScore }}, {{ $json.successProbability }}\n   - Check if Context7 documentation was retrieved: {{ $json.context7Docs }}\n   - Understand the work requirements from packetJSON:\n     â€¢ title: What is being built\n     â€¢ summary: Detailed description\n     â€¢ issues: Related Linear issues\n     â€¢ acceptanceCriteria: How to verify completion\n     â€¢ risks: Potential problems to watch for\n     â€¢ dependencies: Prerequisites or related work\n\n3. USE CONTEXT7 DOCUMENTATION (If Available)\n   - If context7Docs field is present, official documentation has been retrieved\n   - Use this documentation to guide implementation\n   - Follow official best practices from the docs\n   - Reference specific patterns and APIs from the documentation\n\n4. ROUTE TO WORKER BEE\n   Route based on assignedWorker field:\n\n   â€¢ \"worker_bee_opus\" â†’ Use worker_bee_opus1 tool\n     For: Complex architecture, ambiguous requirements, high-risk changes,\n          system design, algorithmic challenges\n\n   â€¢ \"worker_bee_gptoss\" â†’ Use worker_bee_gptoss1 tool\n     For: General coding, refactoring, bug fixes, fast iteration,\n          straightforward features\n\n   â€¢ \"claude_code\" â†’ Use Project Operations tool with action=\"execute_claude_code\"\n     For: Full-stack development, multi-file changes, complex refactoring,\n          agentic development with full context\n     Payload: {\"action\": \"execute_claude_code\", \"payload\": {\"packetID\": \"...\", \"packetJSON\": {...}, \"issueIDs\": [...], \"repoPath\": \"/path\"}}\n\n   â€¢ \"vision_worker\" â†’ Use vision_worker1 tool\n     For: Screenshot analysis, image interpretation, UI comparison,\n          visual verification\n\n5. ENHANCE PROMPT WITH RETRIEVED DOCS\n   - When calling worker bees, include retrieved documentation\n   - Format: \"Official Documentation Retrieved:\\n{{ $json.context7Docs }}\"\n   - Instruct worker to follow official patterns\n\n6. MONITOR & COLLECT RESULTS\n   - Wait for worker bee to complete\n   - Collect the output (should be JSON with specific structure)\n   - Verify completeness of response\n\n7. UPDATE PACKET STATUS\n   - Use Update Project Log tool to store results\n   - Update status: \"completed\", \"failed\", or \"needs_clarification\"\n   - Store worker output in workerOutputJSON field\n   - Store quality metrics: complexity handled, success achieved\n\n8. UPDATE LINEAR ISSUES (Optional)\n   - For each issue in issueIDs:\n     â€¢ Use \"Add a comment to an issue in Linear\" tool\n     â€¢ Post progress update with summary of work done\n\n9. REPORT RESULTS\n   - Generate comprehensive summary\n   - Include: work completed, issues solved, git commits, tests run,\n     blockers, next actions\n   - Include complexity metrics: score handled, probability achieved\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ”§ AVAILABLE TOOLS\n\nDATA TABLES:\nâ€¢ GetPackets: Fetch work packets (ClaudiaCodeIssuePackets)\nâ€¢ GetProjectPlans: Get strategic plans\nâ€¢ Get row(s) in Data table: Get issue details\nâ€¢ GetProjectLog: Get work history\nâ€¢ Update Project Log: Update project metadata\n\nWORKER BEES:\nâ€¢ worker_bee_opus1: Complex/architectural tasks\nâ€¢ worker_bee_gptoss1: General coding/fast iteration\nâ€¢ vision_worker1: Image analysis\n\nDOCUMENTATION:\nâ€¢ Context7Query: Retrieve official library documentation (auto-called before you)\n\nEXTERNAL OPERATIONS:\nâ€¢ Project Operations: Execute via claudia_tools.py\n  - execute_claude_code: Run Claude Code worker\n  - git_setup, git_branch, git_commit: Git operations\n  - run_tests, install_deps: Build operations\n  - create_file, read_file: File I/O\n\nLINEAR:\nâ€¢ Add a comment to an issue in Linear\nâ€¢ Update an issue in Linear\nâ€¢ Create an issue in Linear\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ IMPORTANT RULES\n\n1. ONE PACKET AT A TIME - Focus completely on one packet\n2. ALWAYS UPDATE STATUS - Never leave packets stuck\n3. USE TOOLS PROPERLY - Use Project Operations for file/git ops\n4. USE RETRIEVED DOCS - Include Context7 docs in worker prompts\n5. COMPREHENSIVE RESULTS - Store complete output\n6. ERROR HANDLING - Capture errors, mark packets as failed\n7. NO ASSUMPTIONS - Read packetJSON completely before routing\n8. TRACK METRICS - Store complexity scores and success rates\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ“¤ OUTPUT STRUCTURE\n\nWhen responding, provide a clear summary:\n\nğŸ« Packet: [packetID]\nğŸ“ Title: [title]\nğŸ¤– Worker: [assignedWorker]\nğŸ“Š Complexity: [complexityScore]/100 (Probability: [successProbability]%)\nâœ… Status: [completed/failed/needs_clarification]\n\nğŸ“‹ Work Completed:\n[Summary from worker output]\n\nğŸ¯ Issues Addressed:\n- GTE-123: [what was done]\n\nğŸ’¾ Git Commits:\n- [commit message]\n\nğŸ§ª Tests:\n[Test results]\n\nğŸ“ Files Modified:\n- path/to/file.py\n\nâš ï¸ Blockers (if any):\n- [blocker description]\n\nâ­ï¸ Next Actions:\n- [recommended next step]\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸš€ START\n\nThe work packet has been provided below. Read all fields carefully and route to the appropriate worker.\n\nğŸ“¦ PACKET DATA:\n\npacketJSON: {{ $json.packetJSON }}\n\nplanRunID: {{ $json.planRunID }}\n\nprojectID: {{ $json.projectID }}\n\npacketID: {{ $json.packetID }}\n\nissueIDs: {{ $json.issueIDs }}\n\nassignedWorker: {{ $json.assignedWorker }}\n\nstatus: {{ $json.status }}\n\nğŸ“Š COMPLEXITY ANALYSIS:\n\ncomplexityScore: {{ $json.complexityScore }}\n\nsuccessProbability: {{ $json.successProbability }}\n\ndetectedLibraries: {{ $json.detectedLibraries }}\n\nrecommendedModel: {{ $json.recommendedModel }}\n\nğŸ“š RETRIEVED DOCUMENTATION:\n\n{{ $json.context7Docs || 'No documentation retrieved' }}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[3680,1232],"id":"c241a1df-0ec4-4625-aed0-663fd4abe229","name":"Dev Agent"},{"parameters":{"model":{"__rl":true,"value":"openai/gpt-oss-20b","mode":"list","cachedResultName":"openai/gpt-oss-20b"},"responsesApiEnabled":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[3408,1520],"id":"ce60d0ea-bf53-4270-85a1-17973e86143e","name":"Ministral 3b","credentials":{"openAiApi":{"id":"HE8StVq6t0epqs8Q","name":"BEAST LMStudio"}}},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[4160,1424],"id":"82919e1b-4691-49c5-8d8c-d428dfe515d3","name":"worker_bee_opus1"},{"parameters":{"model":{"__rl":true,"value":"qwen/qwen3-vl-8b","mode":"list","cachedResultName":"qwen/qwen3-vl-8b"},"responsesApiEnabled":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[4160,1600],"id":"f3b8b956-ef8a-4d01-b0f2-39dfcae7ea1a","name":"Claude Opus 4.5 Distill1","credentials":{"openAiApi":{"id":"FYFVsKzjVFK0h0V2","name":"Bedroom LMStudio"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[4304,1600],"id":"d126f2cf-5bd1-4d7d-8fe4-d4aee963e252","name":"Simple Memory11"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[4624,1600],"id":"e1e0a2cf-aa1d-4fc6-9f34-66abc0a484b4","name":"Simple Memory12"},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[4480,1424],"id":"1aafca10-02e4-4e80-809a-1b812d6e0f5c","name":"worker_bee_gptoss1"},{"parameters":{"model":{"__rl":true,"value":"openai/gpt-oss-20b","mode":"list","cachedResultName":"openai/gpt-oss-20b"},"responsesApiEnabled":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[4464,1600],"id":"838f8518-26f4-4259-9274-e57048397572","name":"GPT-OSS-20b1","credentials":{"openAiApi":{"id":"HE8StVq6t0epqs8Q","name":"BEAST LMStudio"}}},{"parameters":{"text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[4784,1424],"id":"880dfe2e-54c4-4062-b618-f82123ace68f","name":"vision_worker1"},{"parameters":{"model":{"__rl":true,"value":"mistralai/ministral-3-3b","mode":"list","cachedResultName":"mistralai/ministral-3-3b"},"responsesApiEnabled":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[4784,1600],"id":"7353e496-e91b-4b44-80d3-a25a5cc004c1","name":"Vision Ministral-3-3b1","credentials":{"openAiApi":{"id":"FYFVsKzjVFK0h0V2","name":"Bedroom LMStudio"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[4960,1600],"id":"a6cc0b8c-84be-4182-9420-1f7e5f6b4ceb","name":"Simple Memory13"},{"parameters":{"description":"Execute side-effectful project operations via claudia_tools.py (git_setup/branch/commit, run_tests, file IO, download_image, complete_workflow).","jsCode":"const action = $parameter[\"action\"];\nconst payload = $parameter[\"payload\"] || {};\n\nif (!/^[a-z_]+$/.test(action)) {\n  throw new Error(`Invalid action: ${action}`);\n}\n\nconst { exec } = require('child_process');\nconst util = require('util');\nconst execPromise = util.promisify(exec);\n\n// NOTE: payload is single-quoted; escape any single quotes inside JSON\nconst payloadStr = JSON.stringify(payload).replace(/'/g, \"\\\\'\");\n\nconst cmd = `python3 '/mnt/n8n-nas/ClaudiaCodeDev/claudia_tools.py' ops ${action} --payload '${payloadStr}'`;\n\ntry {\n  const { stdout } = await execPromise(cmd, { timeout: 300000 });\n  const out = (stdout || \"\").trim();\n  try {\n    return JSON.parse(out);\n  } catch (e) {\n    // If tool returns non-JSON, pass through\n    return { status: \"ok\", raw: out };\n  }\n} catch (error) {\n  return { status: 'error', message: error.message };\n}\n","specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\"type\": \"object\", \"required\": [\"action\", \"payload\"], \"properties\": {\"action\": {\"type\": \"string\", \"description\": \"Operation to execute via claudia_tools.py ops\", \"enum\": [\"detect_project\", \"install_deps\", \"run_tests\", \"git_setup\", \"git_branch\", \"git_commit\", \"download_image\", \"create_file\", \"read_file\", \"complete_workflow\"]}, \"payload\": {\"type\": \"object\", \"description\": \"Action-specific arguments. See claudia_tools.py for accepted keys.\"}}}"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[3824,1056],"id":"226a980c-e2d6-45ef-8e5e-b455d928a564","name":"Project Operations1"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"uY29FyKg9JFPZa9a","mode":"list","cachedResultName":"ClaudiaCodeIssuePackets","cachedResultUrl":"/projects/CDNyPtsGxHdhfdhy/datatables/uY29FyKg9JFPZa9a"},"filters":{"conditions":[{}]},"returnAll":true},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[3568,1520],"id":"274f01d2-0f5b-4bc6-bd87-32a5b5dbe8a4","name":"GetPackets"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"Efxpd5kCkGHvuLFi","mode":"list","cachedResultName":"ClaudiaCodeProjectPlans","cachedResultUrl":"/projects/CDNyPtsGxHdhfdhy/datatables/Efxpd5kCkGHvuLFi"},"filters":{"conditions":[{"keyName":"projectID","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]},"returnAll":true},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[3632,1680],"id":"c5c44bc2-44d6-4ae5-95c8-34ce5a2151fb","name":"GetProjectPlans"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"xFm91lQWMMBRlnho","mode":"list","cachedResultName":"ClaudiaCode Issues","cachedResultUrl":"/projects/CDNyPtsGxHdhfdhy/datatables/xFm91lQWMMBRlnho"},"filters":{"conditions":[{"keyName":"LinearProjectID","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]},"returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}"},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[3456,1680],"id":"d9f91b45-0be6-4543-bdfd-302f6aa60833","name":"Get row(s) in Data table"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"dVG4GzdDQ8rqiOYS","mode":"list","cachedResultName":"ClaudiaCodeProjectLog","cachedResultUrl":"/projects/CDNyPtsGxHdhfdhy/datatables/dVG4GzdDQ8rqiOYS"},"filters":{"conditions":[{"keyName":"projectID","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]},"returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}"},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[3712,1520],"id":"423adf07-12b1-4c7c-9370-e07abfeefaab","name":"GetProjectLog"},{"parameters":{"dataTableId":{"__rl":true,"value":"uheU5SSGQpNjVko5","mode":"list","cachedResultName":"ClaudiaCodeProjects","cachedResultUrl":"/projects/CDNyPtsGxHdhfdhy/datatables/uheU5SSGQpNjVko5"},"columns":{"mappingMode":"defineBelow","value":{"ProjectName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ProjectName', ``, 'string') }}","LinearProjectID":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LinearProjectID', ``, 'string') }}","OpenIssueCount":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('OpenIssueCount', ``, 'number') }}","BacklogIssueCount":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('BacklogIssueCount', ``, 'number') }}","StartedIssueCount":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('StartedIssueCount', ``, 'number') }}","DoneIssueCount":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DoneIssueCount', ``, 'number') }}","LastPacketCount":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LastPacketCount', ``, 'number') }}","ProjectDescription":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ProjectDescription', ``, 'string') }}","ProjectStatus":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ProjectStatus', ``, 'string') }}","LinearTeamID":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LinearTeamID', ``, 'string') }}","LinearTeamName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LinearTeamName', ``, 'string') }}","LeadUserID":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LeadUserID', ``, 'string') }}","Goal":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Goal', ``, 'string') }}","SuccessCriteria":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('SuccessCriteria', ``, 'string') }}","ScopeNotes":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ScopeNotes', ``, 'string') }}","Constraints":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Constraints', ``, 'string') }}","Risks":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Risks', ``, 'string') }}","Dependencies":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Dependencies', ``, 'string') }}","NonGoals":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('NonGoals', ``, 'string') }}","StartDate":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('StartDate', ``, 'string') }}","TargetDate":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('TargetDate', ``, 'string') }}","LastLinearSyncAt":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LastLinearSyncAt', ``, 'string') }}","LastPlannedAt":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LastPlannedAt', ``, 'string') }}","LastPacketizedAt":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LastPacketizedAt', ``, 'string') }}","LastPacketizerRunID":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('LastPacketizerRunID', ``, 'string') }}","ActivePlanRunID":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ActivePlanRunID', ``, 'string') }}","IssueSnapshotHash":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('IssueSnapshotHash', ``, 'string') }}"},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{"optimizeBulk":false}},"type":"n8n-nodes-base.dataTableTool","typeVersion":1,"position":[3792,1680],"id":"3bc16d71-2e4d-48b1-8923-a6dae3221788","name":"Update Project Log"},{"parameters":{"options":{"responseMode":"responseNodes"}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[1680,896],"id":"cfc0a0b8-047c-452e-ae6a-e4c4fd895ce1","name":"When chat message received","webhookId":"ed5004b9-498f-42d7-b641-9904b3c896ab"},{"parameters":{"message":"âœ… Dev Agent Execution Complete\n\nğŸ“‹ Summary:\n{{$json.workCompleted || \"Work completed by worker bee\"}}\n\nğŸ¯ Issues Addressed:\n{{$json.issuesSolved ? $json.issuesSolved.join(\", \") : \"See packet details\"}}\n\nğŸ’¾ Git Commits:\n{{$json.gitCommits ? $json.gitCommits.join(\"\\n\") : \"No commits\"}}\n\nğŸ§ª Tests:\n{{$json.testsRun || \"No test output available\"}}\n\nğŸ“ Files Modified:\n{{$json.filesModified ? $json.filesModified.join(\"\\n\") : \"No files modified\"}}\n\n{{$json.blockers && $json.blockers.length > 0 ? \"âš ï¸ Blockers:\\n\" + $json.blockers.join(\"\\n\") : \"\"}}\n\nâ­ï¸ Next Actions:\n{{$json.nextActions ? $json.nextActions.join(\"\\n\") : \"Review changes manually\"}}\n\n---\nğŸ¤– Worker: {{$json.assignedWorker || \"unknown\"}}\nğŸ“¦ Packet: {{$json.packetID || \"unknown\"}}\nğŸ“Š Complexity: {{$json.complexityScore || \"N/A\"}}/100 ({{$json.successProbability || \"N/A\"}}% predicted)","waitUserReply":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chat","typeVersion":1,"position":[4880,1168],"id":"f93ea372-0ff7-456f-b6f0-7f88d7b6b5da","name":"Respond to Chat"},{"parameters":{"resource":"comment","issueId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Issue_ID', ``, 'string') }}","comment":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Comment', ``, 'string') }}","additionalFields":{}},"type":"n8n-nodes-base.linearTool","typeVersion":1.1,"position":[4016,912],"id":"68efff1f-b359-4e1b-a76a-02043aeb961d","name":"Add a comment to an issue in Linear","credentials":{"linearApi":{"id":"j3L9Kies9EY4eLz9","name":"Linear account"}},"disabled":true},{"parameters":{"operation":"update","issueId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Issue_ID', ``, 'string') }}","updateFields":{}},"type":"n8n-nodes-base.linearTool","typeVersion":1.1,"position":[4336,912],"id":"1e1e0c0f-c318-48c2-905b-05d8f916679d","name":"Update an issue in Linear","credentials":{"linearApi":{"id":"j3L9Kies9EY4eLz9","name":"Linear account"}},"disabled":true},{"parameters":{"teamId":"0dba8752-8337-4077-acea-f20a47598bcb","title":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}","additionalFields":{}},"type":"n8n-nodes-base.linearTool","typeVersion":1.1,"position":[4176,912],"id":"4a8fdb96-3a7d-4831-9c05-2873b4b6fc11","name":"Create an issue in Linear","credentials":{"linearApi":{"id":"j3L9Kies9EY4eLz9","name":"Linear account"}},"disabled":true},{"parameters":{"rule":{"interval":[{"field":"minutes"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[1680,672],"id":"bbae8e55-c3e2-452e-bcd3-fe43ad85918c","name":"Every 5 Minutes (Optional)","disabled":true,"notes":"Enable this to auto-process packets every 5 minutes"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[1680,496],"id":"6fc23bd3-3305-4da6-994f-4ee6b88da067","name":"Manual Trigger","notes":"Click here to manually process packets"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"Efxpd5kCkGHvuLFi","mode":"list","cachedResultName":"ClaudiaCodeProjectPlans"},"filters":{"conditions":[]},"returnAll":true},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[1872,720],"id":"44bcce5e-2368-407c-901b-4fb5d873adcd","name":"Get Available Plan Runs"},{"parameters":{"jsCode":"// Select which plan run to process\nconst planRuns = $input.all();\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// CONFIGURATION - Edit these values to change behavior\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nconst config = {\n  mode: 'latest',  // Options: 'latest', 'specific', 'active'\n  specificPlanRunID: null,  // Set this if mode='specific'\n  \n  // Project filter for testing\n  projectID: null,  // Set to specific project ID or null to process all projects\n};\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n// Filter and sort plan runs\nlet availablePlans = planRuns\n  .map(item => item.json)\n  .filter(plan => {\n    // Exclude stopped plans\n    if (plan.planStatus === 'stopped') return false;\n    \n    // Filter by projectID if configured\n    if (config.projectID && plan.projectID !== config.projectID) return false;\n    \n    return true;\n  });\n\n// Sort by generatedAt (most recent first)\navailablePlans.sort((a, b) => {\n  const dateA = new Date(a.generatedAt || a.createdAt || 0);\n  const dateB = new Date(b.generatedAt || b.createdAt || 0);\n  return dateB - dateA;\n});\n\nif (availablePlans.length === 0) {\n  throw new Error('No available plan runs found for the configured filters');\n}\n\nlet selectedPlan;\n\nswitch (config.mode) {\n  case 'latest':\n    selectedPlan = availablePlans[0];\n    break;\n\n  case 'specific':\n    if (!config.specificPlanRunID) {\n      throw new Error('specificPlanRunID not set in config');\n    }\n    selectedPlan = availablePlans.find(p => p.planRunID === config.specificPlanRunID);\n    if (!selectedPlan) {\n      throw new Error(`Plan run not found: ${config.specificPlanRunID}`);\n    }\n    break;\n\n  case 'active':\n    // Look for plans marked as \"active\" or \"approved\"\n    selectedPlan = availablePlans.find(p =>\n      p.planStatus === 'approved' || p.planStatus === 'active'\n    );\n    if (!selectedPlan) {\n      // Fallback to latest\n      selectedPlan = availablePlans[0];\n    }\n    break;\n\n  default:\n    selectedPlan = availablePlans[0];\n}\n\nreturn [{\n  json: {\n    selectedPlanRunID: selectedPlan.planRunID,\n    projectID: selectedPlan.projectID,\n    planStatus: selectedPlan.planStatus,\n    generatedAt: selectedPlan.generatedAt,\n    totalPlansAvailable: availablePlans.length,\n    selectionMode: config.mode,\n    filterProjectID: config.projectID\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2080,720],"id":"5d6887d4-4d0d-4714-bfaf-b4c1b1c97e3d","name":"Select Plan Run","notes":"Config: mode='latest', projectID=null (processes all projects)"},{"parameters":{"operation":"get","dataTableId":{"__rl":true,"value":"uY29FyKg9JFPZa9a","mode":"list","cachedResultName":"ClaudiaCodeIssuePackets"},"filters":{"conditions":[]},"returnAll":true},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[2272,720],"id":"c1cc7ecc-f669-42cb-9757-c3edca03d999","name":"Fetch All Packets","notes":"âœ… FIXED: Fetches packets before filtering"},{"parameters":{"jsCode":"// Filter packets for the selected plan run\nconst selectedPlan = $('Select Plan Run').first().json;\nconst allPackets = $input.all();\n\n// Filter for queued packets from this plan run\nconst queuedPackets = allPackets\n  .map(item => item.json)\n  .filter(packet =>\n    packet.status === 'queued' &&\n    packet.planRunID === selectedPlan.selectedPlanRunID\n  );\n\nif (queuedPackets.length === 0) {\n  return [{\n    json: {\n      message: 'No queued packets found for plan run: ' + selectedPlan.selectedPlanRunID,\n      selectedPlanRunID: selectedPlan.selectedPlanRunID,\n      hasWork: false\n    }\n  }];\n}\n\n// Return first packet (FIFO)\nconst nextPacket = queuedPackets[0];\n\nreturn [{\n  json: {\n    ...nextPacket,\n    hasWork: true,\n    queueDepth: queuedPackets.length,\n    selectedPlanRunID: selectedPlan.selectedPlanRunID\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2448,720],"id":"32def5c1-3820-4455-8a0f-81dfe865fa79","name":"Get Next Queued Packet","notes":"âœ… FIXED: Now uses $input from 'Fetch All Packets' instead of $('GetPackets')"},{"parameters":{"conditions":{"boolean":[{"value1":"={{ $json.hasWork }}","value2":true}]},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2,"position":[2608,720],"id":"67aadbeb-96d0-4ded-af78-c22987b80a95","name":"Has Work?"},{"parameters":{"jsCode":"// Update packet status to in_progress\nconst packet = $input.first().json;\n\n// Build update payload for data table\nreturn [{\n  json: {\n    // Keep all packet data\n    ...packet,\n    // Update status\n    status: 'in_progress',\n    startedAt: new Date().toISOString(),\n    // Meta for tracking\n    _statusUpdate: 'in_progress',\n    _updatedAt: new Date().toISOString()\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2816,720],"id":"da387eea-1efe-41d9-b452-8b44265dc5c3","name":"Mark In Progress"},{"parameters":{"dataTableId":{"__rl":true,"value":"uY29FyKg9JFPZa9a","mode":"list","cachedResultName":"ClaudiaCodeIssuePackets"},"columns":{"mappingMode":"defineBelow","value":{"status":"={{ $json.status }}","planRunID":"={{ $json.planRunID }}","projectID":"={{ $json.projectID }}","packetID":"={{ $json.packetID }}","issueIDs":"={{ $json.issueIDs }}","assignedWorker":"={{ $json.assignedWorker }}","packetJSON":"={{ $json.packetJSON }}"},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[2992,720],"id":"a4dde896-f178-469a-99ec-2d991495882c","name":"Update DB: In Progress","notes":"âœ… FIXED: Only updates status and startedAt (not static fields)"},{"parameters":{"jsCode":"// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// COMPLEXITY ANALYSIS - Local-First Enhancement\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst packet = $input.first().json;\nconst packetJSON = typeof packet.packetJSON === 'string' \n  ? JSON.parse(packet.packetJSON) \n  : packet.packetJSON;\n\n// Extract fields\nconst title = packetJSON.title || '';\nconst summary = packetJSON.summary || packetJSON.description || '';\nconst labels = packetJSON.labels || [];\nconst issueIDs = packet.issueIDs || [];\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// COMPLEXITY SCORING ALGORITHM\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nlet complexityScore = 0;\n\n// 1. Description Length (0-20 points)\nconst descLength = summary.length;\nif (descLength < 100) complexityScore += 5;\nelse if (descLength < 300) complexityScore += 10;\nelse if (descLength < 600) complexityScore += 15;\nelse complexityScore += 20;\n\n// 2. Keyword Analysis (0-40 points)\nconst complexKeywords = [\n  'distributed', 'scalable', 'real-time', 'websocket', 'async', 'concurrent',\n  'performance', 'optimization', 'refactor', 'architecture', 'microservice',\n  'kubernetes', 'docker', 'ci/cd', 'pipeline', 'deployment', 'migration',\n  'security', 'authentication', 'authorization', 'encryption', 'compliance',\n  'algorithm', 'complex', 'advanced', 'sophisticated', 'enterprise'\n];\n\nconst mediumKeywords = [\n  'api', 'endpoint', 'database', 'query', 'model', 'validation', 'testing',\n  'integration', 'component', 'service', 'handler', 'middleware', 'router',\n  'controller', 'repository', 'orm', 'sql', 'nosql', 'redis', 'cache'\n];\n\nconst text = (title + ' ' + summary).toLowerCase();\nlet complexCount = 0;\nlet mediumCount = 0;\n\ncomplexKeywords.forEach(kw => {\n  if (text.includes(kw)) complexCount++;\n});\n\nmediumKeywords.forEach(kw => {\n  if (text.includes(kw)) mediumCount++;\n});\n\ncomplexityScore += Math.min(complexCount * 8, 30);\ncomplexityScore += Math.min(mediumCount * 3, 10);\n\n// 3. Label Analysis (0-20 points)\nconst epicLabels = ['epic', 'large', 'complex', 'critical', 'security'];\nconst mediumLabels = ['feature', 'enhancement', 'backend', 'frontend'];\nconst simpleLabels = ['bug', 'bugfix', 'hotfix', 'beginner', 'simple', 'documentation'];\n\nlabels.forEach(label => {\n  const labelLower = label.toLowerCase();\n  if (epicLabels.some(l => labelLower.includes(l))) complexityScore += 15;\n  else if (mediumLabels.some(l => labelLower.includes(l))) complexityScore += 5;\n  else if (simpleLabels.some(l => labelLower.includes(l))) complexityScore -= 10;\n});\n\n// 4. Multi-file indicator (0-20 points)\nif (text.match(/multiple files|several files|many files|refactor/i)) {\n  complexityScore += 15;\n}\n\n// Normalize to 0-100\ncomplexityScore = Math.max(0, Math.min(100, complexityScore));\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// LIBRARY DETECTION\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst libraryPatterns = [\n  { name: 'react', pattern: /\\breact\\b/i },\n  { name: 'fastapi', pattern: /\\bfastapi\\b/i },\n  { name: 'django', pattern: /\\bdjango\\b/i },\n  { name: 'flask', pattern: /\\bflask\\b/i },\n  { name: 'sqlalchemy', pattern: /\\bsqlalchemy\\b/i },\n  { name: 'pydantic', pattern: /\\bpydantic\\b/i },\n  { name: 'redis', pattern: /\\bredis\\b/i },\n  { name: 'postgres', pattern: /\\bpostgres|postgresql\\b/i },\n  { name: 'mongodb', pattern: /\\bmongo|mongodb\\b/i },\n  { name: 'graphql', pattern: /\\bgraphql\\b/i },\n  { name: 'jwt', pattern: /\\bjwt|json web token\\b/i },\n  { name: 'oauth', pattern: /\\boauth\\b/i },\n  { name: 'next.js', pattern: /\\bnext\\.?js\\b/i },\n  { name: 'typescript', pattern: /\\btypescript|\\bts\\b/i },\n  { name: 'tailwind', pattern: /\\btailwind\\b/i },\n];\n\nconst detectedLibraries = [];\nlibraryPatterns.forEach(lib => {\n  if (lib.pattern.test(text)) {\n    detectedLibraries.push(lib.name);\n  }\n});\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// SUCCESS PROBABILITY ESTIMATION\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nlet successProbability;\n\nif (complexityScore < 20) {\n  // Simple tasks - ministral-3b\n  successProbability = 94;\n} else if (complexityScore < 40) {\n  // Medium-simple - qwen/gpt-oss with docs\n  successProbability = detectedLibraries.length > 0 ? 88 : 72;\n} else if (complexityScore < 70) {\n  // Medium-complex - gpt-oss with docs\n  successProbability = detectedLibraries.length > 0 ? 84 : 68;\n} else {\n  // Complex - needs planning or escalation\n  successProbability = 45;\n}\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// MODEL RECOMMENDATION\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nlet recommendedModel;\nlet needsContext7 = false;\nlet needsPlanning = false;\n\nif (complexityScore < 20) {\n  recommendedModel = 'ministral-3b';\n} else if (complexityScore < 40) {\n  recommendedModel = detectedLibraries.length > 0 ? 'qwen3-vl-8b' : 'gpt-oss-20b';\n  needsContext7 = detectedLibraries.length > 0;\n} else if (complexityScore < 70) {\n  recommendedModel = 'gpt-oss-20b';\n  needsContext7 = true;\n} else {\n  recommendedModel = 'gpt-oss-20b-with-planning';\n  needsContext7 = true;\n  needsPlanning = true;\n}\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// OUTPUT\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nreturn [{\n  json: {\n    ...packet,\n    complexityScore,\n    successProbability,\n    detectedLibraries,\n    recommendedModel,\n    needsContext7,\n    needsPlanning,\n    analysisTimestamp: new Date().toISOString(),\n    // Route decision\n    routeToPlanning: needsPlanning,\n    routeToContext7: needsContext7,\n    // Keep original packet data\n    _originalPacket: packet\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3184,720],"id":"NEW-complexity-analysis","name":"Analyze Complexity","notes":"ğŸ†• LOCAL-FIRST: Calculates complexity score, success probability, detects libraries"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"simple-route","leftValue":"={{ $json.complexityScore }}","rightValue":"30","operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[3376,720],"id":"NEW-route-by-complexity","name":"Route by Complexity","notes":"ğŸ†• Routes: <30=direct, 30-70=context7, >70=planning"},{"parameters":{"jsCode":"// Simple task - proceed directly to Dev Agent\nconst packet = $input.first().json;\n\nreturn [{\n  json: {\n    ...packet,\n    context7Docs: null,\n    routingDecision: 'direct',\n    estimatedCost: 0\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3552,560],"id":"NEW-simple-route","name":"Simple: Direct to Agent","notes":"ğŸ†• Score <30: Direct execution, no docs needed"},{"parameters":{"jsCode":"// Medium complexity - retrieve Context7 docs\nconst packet = $input.first().json;\nconst libraries = packet.detectedLibraries || [];\n\n// This would normally call Context7 MCP\n// For now, we'll mark it as needing docs and let Dev Agent handle it\n\nreturn [{\n  json: {\n    ...packet,\n    routingDecision: 'context7',\n    librariesToQuery: libraries,\n    estimatedCost: 0,\n    // Placeholder - actual Context7 integration would happen here\n    _needsContext7Query: true\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3552,720],"id":"NEW-medium-route","name":"Medium: Query Context7","notes":"ğŸ†• Score 30-70: Retrieve official docs via Context7 MCP"},{"parameters":{"jsCode":"// Complex task - request planning approval\nconst packet = $input.first().json;\n\n// Calculate estimated cost\nconst planningCost = 0.50; // Claude Code planning\nconst executionCost = 0; // Will use local models\n\nreturn [{\n  json: {\n    ...packet,\n    routingDecision: 'planning_approval_needed',\n    estimatedPlanningCost: planningCost,\n    estimatedExecutionCost: executionCost,\n    estimatedTotalCost: planningCost + executionCost,\n    approvalMessage: `Complex task detected (score: ${packet.complexityScore}/100). ` +\n      `Recommend Claude planning ($${planningCost}) followed by local execution. ` +\n      `Success probability: ${packet.successProbability}%`,\n    _needsApproval: true\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3552,880],"id":"NEW-complex-route","name":"Complex: Request Planning Approval","notes":"ğŸ†• Score >70: Request user approval for Claude planning"},{"parameters":{"jsCode":"// Store worker results in database\nconst packet = $('Merge Routes').first().json;\nconst workerOutput = $input.first().json;\n\n// Determine final status\nlet finalStatus = 'completed';\nif (workerOutput.status === 'failed') {\n  finalStatus = 'failed';\n} else if (workerOutput.status === 'needs_clarification') {\n  finalStatus = 'needs_clarification';\n}\n\nreturn [{\n  json: {\n    packetID: packet.packetID,\n    status: finalStatus,\n    workerOutputJSON: JSON.stringify(workerOutput),\n    completedAt: new Date().toISOString(),\n    // Store complexity metrics\n    complexityScore: packet.complexityScore,\n    successProbability: packet.successProbability,\n    actualSuccess: finalStatus === 'completed',\n    routingDecision: packet.routingDecision,\n    estimatedCost: packet.estimatedCost || 0,\n    // Pass through for work log\n    _workerOutput: workerOutput,\n    _packet: packet\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4048,1168],"id":"48475637-ac9a-4432-bed5-5d3297134a76","name":"Prepare Results"},{"parameters":{"dataTableId":{"__rl":true,"value":"uY29FyKg9JFPZa9a","mode":"list","cachedResultName":"ClaudiaCodeIssuePackets"},"columns":{"mappingMode":"defineBelow","value":{"status":"={{ $json.status }}","workerOutputJSON":"={{ $json.workerOutputJSON }}"},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[4256,1168],"id":"97ef470b-08ba-4b36-835f-0be33c92d598","name":"Update DB: Completed","notes":"âœ… FIXED: Now writes completedAt timestamp + complexity metrics"},{"parameters":{"jsCode":"// Append work to persistent log for quality verification\nconst result = $input.first().json;\nconst workerOutput = result._workerOutput;\nconst packet = result._packet;\n\n// Create work log entry\nconst logEntry = {\n  timestamp: new Date().toISOString(),\n  packetID: packet.packetID,\n  planRunID: packet.planRunID,\n  projectID: packet.projectID,\n  assignedWorker: packet.assignedWorker,\n  status: result.status,\n  title: packet.packetJSON?.title || 'Untitled',\n  issueIDs: packet.issueIDs,\n  // New: Complexity metrics\n  complexityScore: result.complexityScore,\n  successProbability: result.successProbability,\n  actualSuccess: result.actualSuccess,\n  routingDecision: result.routingDecision,\n  estimatedCost: result.estimatedCost,\n  // Existing fields\n  workCompleted: workerOutput.workCompleted,\n  issuesSolved: workerOutput.issuesSolved || [],\n  gitCommits: workerOutput.gitCommits || [],\n  testsRun: workerOutput.testsRun || '',\n  filesModified: workerOutput.filesModified || [],\n  blockers: workerOutput.blockers || [],\n  nextActions: workerOutput.nextActions || []\n};\n\nreturn [{\n  json: {\n    logEntry,\n    // Also return for final response\n    ...result\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4448,1168],"id":"bd08e8e1-8a66-4530-ad5f-a9cbf0254dcd","name":"Append to Work Log"},{"parameters":{"jsCode":"// Save work log entry to persistent storage\nconst entry = $input.first().json.logEntry;\n\n// Option 1: Append to JSON file (simple, good for testing)\nconst fs = require('fs');\nconst path = require('path');\nconst logFile = '/mnt/n8n-nas/claudia_work_log.json';\n\nlet workLog = [];\n\n// Read existing log\ntry {\n  if (fs.existsSync(logFile)) {\n    const data = fs.readFileSync(logFile, 'utf8');\n    workLog = JSON.parse(data);\n  }\n} catch (err) {\n  console.error('Error reading work log:', err);\n  workLog = [];\n}\n\n// Append new entry\nworkLog.push(entry);\n\n// Keep only last 1000 entries (prevent file from growing too large)\nif (workLog.length > 1000) {\n  workLog = workLog.slice(-1000);\n}\n\n// Save\ntry {\n  fs.writeFileSync(logFile, JSON.stringify(workLog, null, 2), 'utf8');\n} catch (err) {\n  console.error('Error writing work log:', err);\n}\n\nreturn [{\n  json: {\n    message: 'Work log updated',\n    logFile,\n    totalEntries: workLog.length,\n    latestEntry: entry\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4656,1168],"id":"7880f084-ee02-4a13-a949-984edeb23dee","name":"Save Work Log to File","notes":"Saves to /mnt/n8n-nas/claudia_work_log.json with complexity metrics"},{"parameters":{"jsCode":"return [{\n  json: {\n    message: 'No queued packets available for processing',\n    timestamp: new Date().toISOString()\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2608,928],"id":"1fba1fb4-3cfc-4f52-991a-6e5af7f27fe1","name":"No Work Available"},{"parameters":{"mode":"mergeByPosition"},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[3680,720],"id":"NEW-merge-routes","name":"Merge Routes","notes":"ğŸ†• Merges all routing paths back together"}],"connections":{"Ministral 3b":{"ai_languageModel":[[{"node":"Dev Agent","type":"ai_languageModel","index":0}]]},"worker_bee_opus1":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"Claude Opus 4.5 Distill1":{"ai_languageModel":[[{"node":"worker_bee_opus1","type":"ai_languageModel","index":0}]]},"Simple Memory11":{"ai_memory":[[{"node":"worker_bee_opus1","type":"ai_memory","index":0}]]},"Simple Memory12":{"ai_memory":[[{"node":"worker_bee_gptoss1","type":"ai_memory","index":0}]]},"worker_bee_gptoss1":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"GPT-OSS-20b1":{"ai_languageModel":[[{"node":"worker_bee_gptoss1","type":"ai_languageModel","index":0}]]},"vision_worker1":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"Vision Ministral-3-3b1":{"ai_languageModel":[[{"node":"vision_worker1","type":"ai_languageModel","index":0}]]},"Simple Memory13":{"ai_memory":[[{"node":"vision_worker1","type":"ai_memory","index":0}]]},"Project Operations1":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"GetPackets":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"GetProjectPlans":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"Get row(s) in Data table":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"GetProjectLog":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"Update Project Log":{"ai_tool":[[{"node":"Dev Agent","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Get Available Plan Runs","type":"main","index":0}]]},"Dev Agent":{"main":[[{"node":"Prepare Results","type":"main","index":0}]]},"Every 5 Minutes (Optional)":{"main":[[{"node":"Get Available Plan Runs","type":"main","index":0}]]},"Manual Trigger":{"main":[[{"node":"Get Available Plan Runs","type":"main","index":0}]]},"Get Available Plan Runs":{"main":[[{"node":"Select Plan Run","type":"main","index":0}]]},"Select Plan Run":{"main":[[{"node":"Fetch All Packets","type":"main","index":0}]]},"Fetch All Packets":{"main":[[{"node":"Get Next Queued Packet","type":"main","index":0}]]},"Get Next Queued Packet":{"main":[[{"node":"Has Work?","type":"main","index":0}]]},"Has Work?":{"main":[[{"node":"Mark In Progress","type":"main","index":0}],[{"node":"No Work Available","type":"main","index":0}]]},"Mark In Progress":{"main":[[{"node":"Update DB: In Progress","type":"main","index":0}]]},"Update DB: In Progress":{"main":[[{"node":"Analyze Complexity","type":"main","index":0}]]},"Analyze Complexity":{"main":[[{"node":"Route by Complexity","type":"main","index":0}]]},"Route by Complexity":{"main":[[{"node":"Simple: Direct to Agent","type":"main","index":0}],[{"node":"Medium: Query Context7","type":"main","index":0}],[{"node":"Complex: Request Planning Approval","type":"main","index":0}]]},"Simple: Direct to Agent":{"main":[[{"node":"Merge Routes","type":"main","index":0}]]},"Medium: Query Context7":{"main":[[{"node":"Merge Routes","type":"main","index":1}]]},"Complex: Request Planning Approval":{"main":[[{"node":"Merge Routes","type":"main","index":2}]]},"Merge Routes":{"main":[[{"node":"Dev Agent","type":"main","index":0}]]},"Prepare Results":{"main":[[{"node":"Update DB: Completed","type":"main","index":0}]]},"Update DB: Completed":{"main":[[{"node":"Append to Work Log","type":"main","index":0}]]},"Append to Work Log":{"main":[[{"node":"Save Work Log to File","type":"main","index":0}]]},"Save Work Log to File":{"main":[[{"node":"Respond to Chat","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true,"instanceId":"45ffe7d11054753081d928dced0b4b0a0d8cb635b476bc8af970bb8becfaf461"},"pinData":{},"versionId":"5c73f4bd-e61e-471d-ab7b-4b1254368b52","activeVersionId":null,"versionCounter":1,"triggerCount":0,"shared":[{"updatedAt":"2026-01-08T03:53:04.184Z","createdAt":"2026-01-08T03:53:04.184Z","role":"workflow:owner","workflowId":"dDjj3kYrVBJYD5VA","projectId":"CUaRGVU8MRvL0tdd","project":{"updatedAt":"2026-01-08T03:51:38.610Z","createdAt":"2026-01-08T03:45:43.415Z","id":"CUaRGVU8MRvL0tdd","name":"Bill Admin <bill@gtechsd.com>","type":"personal","icon":null,"description":null,"creatorId":"e443d61e-c22a-49d2-8855-c41dbca9834a","projectRelations":[{"updatedAt":"2026-01-08T03:45:43.415Z","createdAt":"2026-01-08T03:45:43.415Z","userId":"e443d61e-c22a-49d2-8855-c41dbca9834a","projectId":"CUaRGVU8MRvL0tdd","user":{"updatedAt":"2026-01-09T00:02:08.000Z","createdAt":"2026-01-08T03:45:43.034Z","id":"e443d61e-c22a-49d2-8855-c41dbca9834a","email":"bill@gtechsd.com","firstName":"Bill","lastName":"Admin","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2026-01-08T06:16:56.079Z","personalization_survey_n8n_version":"2.2.4"},"settings":{"userActivated":false},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-09","isPending":false}}]}}],"tags":[],"activeVersion":null}